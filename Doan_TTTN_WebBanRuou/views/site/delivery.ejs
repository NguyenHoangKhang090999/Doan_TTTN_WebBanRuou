<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Delivery</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="eCommerce HTML Template Free Download" name="keywords" />
    <meta content="eCommerce HTML Template Free Download" name="description" />

    <!-- Favicon -->
    <link rel="shortcut icon" href="img/favicon.ico" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400|Source+Code+Pro:700,900&display=swap"
      rel="stylesheet"
    />

    <!-- CSS Libraries -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="../lib/slick/slick.css" rel="stylesheet" />
    <link href="../lib/slick/slick-theme.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="../css/style.css" rel="stylesheet" />
    <link href="../scss/style2.css" rel="stylesheet" />
  </head>

  <body>
    <!-- Nav Bar Start -->
    <div class="nav">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-md bg-dark navbar-dark">
          <a href="#" class="navbar-brand">MENU</a>
          <button
            type="button"
            class="navbar-toggler"
            data-toggle="collapse"
            data-target="#navbarCollapse"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div
            class="collapse navbar-collapse justify-content-between"
            id="navbarCollapse"
          >
            <div class="navbar-nav ml-auto"></div>
          </div>
        </nav>
      </div>
    </div>
    <!-- Nav Bar End -->

    <!-- My Account Start -->
    <div class="my-account">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3">
            <div
              class="nav flex-column nav-pills"
              role="tablist"
              aria-orientation="vertical"
            >
              <a
                class="nav-link active"
                id="dashboard-nav"
                data-toggle="pill"
                href="#dashboard-tab"
                role="tab"
                ><i class="fa fa-tachometer-alt"></i>Chào <%=user.ten%></a
              >
              <a
                class="nav-link"
                id="orders-nav"
                data-toggle="pill"
                href="#orders-tab"
                role="tab"
                ><i class="fa fa-shopping-bag"></i>Đơn Hàng của bạn</a
              >

              <a
                class="nav-link"
                id="orders-nav"
                data-toggle="pill"
                href="#history-tab"
                role="tab"
                ><i class="fa fa-shopping-bag"></i>Lịch sử giao hàng</a
              >
              <a
                class="nav-link"
                id="account-nav"
                data-toggle="pill"
                href="#account-tab"
                role="tab"
                ><i class="fa fa-user"></i>Chi Tiết Tài Khoản</a
              >
              <a class="nav-link" href="/users/dang-xuat"
                ><i class="fa fa-sign-out-alt"></i>Đăng Xuất</a
              >
            </div>
          </div>
          <div class="col-md-9">
            <div class="tab-content">
              <div
                class="tab-pane fade show active"
                id="dashboard-tab"
                role="tabpanel"
                aria-labelledby="dashboard-nav"
              >
                <h4>Chào <%=user.ten%></h4>
                <p>Đây là trang quản lý tài khoản của bạn.</p>
              </div>
              <div
                class="tab-pane fade"
                id="orders-tab"
                role="tabpanel"
                aria-labelledby="orders-nav"
              >
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead class="thead-dark">
                      <tr>
                        <th>No</th>
                        <th>Thông tin đặt hàng</th>
                        <th>Ngày đặt</th>
                        <th>Giá trị</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody id="list-orders-user">
                      <!-- <tr>
                        <td>1</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr> -->
                    </tbody>
                  </table>
                </div>
              </div>

              <div
                class="tab-pane fade"
                id="history-tab"
                role="tabpanel"
                aria-labelledby="orders-nav"
              >
                <div class="table-responsive">
                  <table class="table table-bordered">
                    <thead class="thead-dark">
                      <tr>
                        <th>No</th>
                        <th>Thông tin đặt hàng</th>
                        <th>Ngày đặt</th>
                        <th>Giá trị</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody id="list-history">
                      <!-- <tr>
                        <td>1</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>Product Name</td>
                        <td>01 Jan 2020</td>
                        <td>$99</td>
                        <td>Approved</td>
                        <td><button class="btn">View</button></td>
                      </tr> -->
                    </tbody>
                  </table>
                </div>
              </div>

              <div
                class="tab-pane fade"
                id="payment-tab"
                role="tabpanel"
                aria-labelledby="payment-nav"
              >
                <h4>Payment Method</h4>
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. In
                  condimentum quam ac mi viverra dictum. In efficitur ipsum
                  diam, at dignissim lorem tempor in. Vivamus tempor hendrerit
                  finibus. Nulla tristique viverra nisl, sit amet bibendum ante
                  suscipit non. Praesent in faucibus tellus, sed gravida lacus.
                  Vivamus eu diam eros. Aliquam et sapien eget arcu rhoncus
                  scelerisque.
                </p>
              </div>
              <div
                class="tab-pane fade"
                id="address-tab"
                role="tabpanel"
                aria-labelledby="address-nav"
              >
                <h4>Address</h4>
                <div class="row">
                  <div class="col-md-6">
                    <h5>Payment Address</h5>
                    <p>123 Payment Street, Los Angeles, CA</p>
                    <p>Mobile: 012-345-6789</p>
                    <button class="btn">Edit Address</button>
                  </div>
                  <div class="col-md-6">
                    <h5>Shipping Address</h5>
                    <p>123 Shipping Street, Los Angeles, CA</p>
                    <p>Mobile: 012-345-6789</p>
                    <button class="btn">Edit Address</button>
                  </div>
                </div>
              </div>
              <div
                class="tab-pane fade"
                id="account-tab"
                role="tabpanel"
                aria-labelledby="account-nav"
              >
                <h4>Chi Tiết Tài Khoản</h4>
                <form action="/users/update" method="post">
                  <div class="row">
                    <div class="col-md-6">
                      <label for="ho">Họ</label>
                      <input
                        id="ho"
                        name="ho"
                        value="<%=user.ho%>"
                        class="form-control"
                        type="text"
                        placeholder="Họ"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="ten">Tên</label>
                      <input
                        id="ten"
                        name="ten"
                        value="<%=user.ten%>"
                        class="form-control"
                        type="text"
                        placeholder="Tên"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="phone">Số điện thoại</label>
                      <input
                        id="phone"
                        name="phone"
                        value="<%=user.phone%>"
                        class="form-control"
                        type="text"
                        placeholder="Số Điện Thoại"
                      />
                    </div>
                    <div class="col-md-6">
                      <label for="email">Email</label>
                      <input
                        id="email"
                        name="email"
                        value="<%=user.email%>"
                        class="form-control"
                        type="text"
                        placeholder="Email"
                      />
                    </div>
                    <div class="col-md-12">
                      <label for="address">Địa chỉ</label>
                      <input
                        name="address"
                        value="<%=user.address%>"
                        class="form-control"
                        type="text"
                        placeholder="Địa Chỉ"
                      />
                    </div>
                    <div class="col-md-12">
                      <button class="btn">Cập Nhật Tài Khoản</button>
                      <br /><br />
                    </div>
                  </div>
                </form>
                <h4>Đổi Mật Khẩu</h4>
                <form action="/users/doi-mat-khau" method="post">
                  <div class="row">
                    <div class="col-md-12">
                      <input
                        name="password"
                        class="form-control"
                        type="password"
                        placeholder="Mật khẩu hiện tại"
                      />
                    </div>
                    <div class="col-md-6">
                      <input
                        name="newPassword"
                        class="form-control"
                        type="text"
                        placeholder="Mật khẩu mới"
                      />
                    </div>
                    <div class="col-md-6">
                      <input
                        name="confirmPassword"
                        class="form-control"
                        type="text"
                        placeholder="Xác nhận mật khẩu mới"
                      />
                    </div>
                    <div class="col-md-12">
                      <button class="btn">Đổi mật khẩu</button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- My Account End -->

    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="../lib/easing/easing.min.js"></script>
    <script src="../lib/slick/slick.min.js"></script>

    <!-- Template Javascript -->
    <script src="../js/main.js"></script>
  </body>
</html>
<script>
  function getaddress(addr) {
    console.log(addr);
    localStorage.setItem("addressMapKey", addr);
    window.location = "../quan-tri/map";
  }

  const renderlistorder = (data, id) => {
    const divNonNoiBat = document.getElementById(id);
    let str = ``;
    for (i in data) {
      let d = data[i];
      let orderdate = new Date(d.NGAYDAT);
      let datetime =
        orderdate.getDate() +
        "/" +
        (orderdate.getMonth() + 1) +
        "/" +
        orderdate.getFullYear();

      str += ` <tr>
                        <td>${++i}</td>
                        <td style="width:400px">Họ và tên: ${d.HONN} ${
        d.TENNN
      }<br/> Địa chỉ: ${d.DIACHINN}.<br/> Phone: ${d.SDTNN}</td>
                        <td>${datetime}</td>
                        <td>${d.THANHTIEN}$</td>
                        <td style="color: green">Chờ giao hàng...</td>
                        <td><a href="/quan-tri/review_order/${
                          d.MAPD
                        }" class="btn btn-primary"><i class="fas fa-search"></i></a>
                        <a href="/quan-tri/Bill/${
                          d.MAPD
                        }" class="btn btn-primary"><i class="far fa-file-alt"></i></a>
                        <button onclick="getaddress('${
                          d.DIACHINN
                        }')"><i class="fas fa-location-arrow" style="color:#509BC7"></i></button>
                        </td>
                        </td>
                      </tr>
                    </tr>`;
    }
    divNonNoiBat.innerHTML += str;
  };

  const renderlistHistory = (data, id) => {
    const divNonNoiBat = document.getElementById(id);
    let str = ``;
    for (i in data) {
      let d = data[i];
      let orderdate = new Date(d.NGAYDAT);
      let datetime =
        orderdate.getDate() +
        "/" +
        (orderdate.getMonth() + 1) +
        "/" +
        orderdate.getFullYear();

      str += ` <tr>
                        <td>${++i}</td>
                        <td style="width:400px">Họ và tên: ${d.HONN} ${
        d.TENNN
      }<br/> Địa chỉ: ${d.DIACHINN}.<br/> Phone: ${d.SDTNN}</td>
                        <td>${datetime}</td>
                        <td>${d.THANHTIEN}$</td>
                        <td style="color: green">Hoàn thành</td>
                        <td><a href="/quan-tri/review_order/${
                          d.MAPD
                        }" class="btn btn-primary"><i class="fas fa-search"></i></a>
                        <a href="/quan-tri/Bill/${
                          d.MAPD
                        }" class="btn btn-primary"><i class="far fa-file-alt"></i></a>
                        </td>
                      </tr>
                    </tr>`;
    }
    divNonNoiBat.innerHTML += str;
  };

  window
    .fetch("http://localhost:3000/users/api/all-list-delivery")
    .then((res) => {
      return res.json();
    })
    .then((data) => {
      console.log(data);
      let id = "list-orders-user";
      renderlistorder(data, id);
    })
    .catch((err) => {
      console.log(err);
    });

  window
    .fetch("http://localhost:3000/users/api/all-list-delivery-finish")
    .then((res) => {
      return res.json();
    })
    .then((data) => {
      console.log(data);
      let id = "list-history";
      renderlistHistory(data, id);
    })
    .catch((err) => {
      console.log(err);
    });
</script>
